<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Shantell+Sans:ital,wght@0,300..800;1,300..800&display=swap" rel="stylesheet">
  <style>
    :root {
      --unit: calc(1vh + 3vw);
      --border: 0.4vh;
      --font: clamp(0.9em, 1.5vw, 1.2em);
      --col1: #FDE7B3;
      --col2: #FFC50F;
      --col3: #63A361;
      --col4: #5B532C;
      
    }
    
    body {
      user-select: none;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: linear-gradient(190deg, var(--col1), var(--col1));
      height: 100vh;
      color: var(--col1);
      width: 100vw;
      overflow: hidden;
      font-size: var(--unit);
      font-family: "Shantell Sans", monospace;
      font-optical-sizing: auto;
      font-weight: <weight>;
      font-style: normal;
      font-variation-settings:
        "BNCE" 0,
        "INFM" 0,
        "SPAC" 0;
    }
    
    
    
    span {
      font-size: var(--unit);
      font-weight: bold;
      display: inline-flex;
      justify-content: center;
      align-items: center;
      position: fixed;
      top: 0%;
      height: 3%;
      width: 100vw;
      z-index: 1000;
    }
    
    span a {
      text-decoration: none;
      color: var(--col2);
      animation: fusionPulse 2s infinite ease-in-out;
    }
    
    #tabs {
      top: 3%;
      position: fixed;
      display: flexbox;
      z-index: 999;
      margin: 0;
    }
    
    .edit-button {
      z-index: 3;
      position: absolute;
      bottom: 1vh;
      left: 5vw;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 0px;
      color: var(--col1);
      cursor: pointer;
      font-size: 10px;
    }
    
    .edit-button bdi {
      text-decoration: underline;
    }
    
    #courseTabs .tab {
      padding: 1% 8%;
    }
    
    .tabs {
      width: 100vw;
      display: flex;
      margin: 0%;
      position: relative;
      justify-content: space-evenly;
      align-items: center;
      text-align: center;
    }
    
    .tab {
      padding: 1% 3%;
      margin: 0%;
      border: 2.5px dashed var(--col4);
      box-sizing: border-box;
      border-radius: 20px;
      background-color: var(--col2);
      color: var(--col4);
      font-weight: bold;
      font-size: 50%;
      transition: background-color 0.3s, color 0.3s;
    }
    
    .tab.active {
      background-color: var(--col4);
      color: var(--col1);
      box-shadow: 0 1% 10px rgba(0, 0, 0, 0.2);
      border: 3px double var(--col3);
      position: relative;
    }
    
    /* ==== Tunable design tokens ==== */
    #fresh {
      --fg: var(--col4);
      /* text/icon color */
      --bg: var(--col1);
      /* background */
      --ring: var(--col2);
      /* border */
      --hover-bg: var(--col3);
      --active-bg: var(--col3);
      --gap: .5em;
      /* space between text and icon */
      --radius: 9999px;
      /* pill shape */
      --pad-y: .5em;
      /* vertical padding scales with font-size */
      --pad-x: .9em;
      /* horizontal padding */
      --icon: 1.15em;
      /* icon size relative to text */
      --shadow: 0 1px 2px rgba(0, 0, 0, .06), 0 2px 6px rgba(0, 0, 0, .06);
    }
    
    /* ==== Base container ==== */
    #fresh {
      display: inline-flex;
      /* keep content on one line and centered */
      align-items: center;
      gap: var(--gap);
      padding: var(--pad-y) var(--pad-x);
      border-radius: var(--radius);
      border: 0px solid var(--ring);
      background: var(--bg);
      color: var(--fg);
      line-height: 1;
      /* steady height, no baseline wobble */
      font-weight: 600;
      font-size: 12px;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
      box-shadow: var(--shadow);
      cursor: default;
      /* change to pointer if clickable */
      z-index: 3;
      position: absolute;
      bottom: 3vh;
      right: 1vw;
    }
    
    /* If you want it clickable, add role/button styles */
    #fresh[role="button"] {
      cursor: pointer;
    }
    
    #fresh:focus-visible {
      outline: 2px solid var(--col1);
      /* focus ring */
      outline-offset: 2px;
      box-shadow: none;
    }
    
    /* ==== SVG icon ==== */
    #fresh svg {
      width: var(--icon);
      height: var(--icon);
      display: block;
      /* removes inline svg descender gap */
      fill: currentColor;
      /* inherits text color */
      flex: 0 0 auto;
    }
    
    /* Keep the text tidy even if it wraps (rare with inline-flex) */
    #fresh {
      white-space: nowrap;
    }
    
    /* ==== Optional: ‚Äúsyncing‚Äù state (spins the icon) ==== */
    #fresh.is-syncing svg {
      animation: spin 1s linear infinite;
    }
    
    /* Hover/active override when syncing */
    #fresh.is-syncing:hover,
    #fresh.is-syncing:active {
      background: var(--bg);
      transform: none;
      cursor: default;
      box-shadow: var(--shadow);
    }
    
    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }
    
    /* Respect reduced motion */
    @media (prefers-reduced-motion: reduce) {
      #fresh.is-syncing svg {
        animation: none;
      }
    }
    
    strong:first-child {
      /*animation: fusionPulse 10s infinite ease-in-out;*/
      display: inline;
      width: 90%;
      white-space: wrap;
      /* Needed for transform effects */
      font-size: 150%;
      padding: .5% 2%;
      background: linear-gradient(90deg, var(--col1), var(--col3));
      border-radius: 15px;
    }
    
    strong:nth-child(2) {
      font-size: 150%;
      font-weight: 700;
      display: inline;
      color: var(--col1);
      border-radius: 15px;
      background: linear-gradient(90deg, var(--col4), var(--col3));
      padding: .5%;
      margin: .55%;
    }
    
    strong:nth-child(3) {
      font-size: 130%;
      margin-left: 1%;
    }
    
    em {
      font-style: normal;
      display: inline-block;
      font-weight: 900;
      font-size: 130%;
      box-sizing: border-box;
      border: 2.5px double var(--col4);
      background: var(--col2);
      color: var(--col1);
      border-radius: 30px;
      margin: 0%;
      padding: 1%;
      -webkit-text-stroke: 1px var(--col4);
    }
    
    em.shake {
      animation: shaking 1s ease-in-out infinite;
    }
    
    @keyframes fusionPulse {
      0% {
        opacity: 0.7;
        transform: scale(1);
        color: var(--col4);
      }
      
      50% {
        opacity: 1;
        transform: scale(1.02);
        color: var(--col4);
      }
      
      100% {
        opacity: 0.7;
        transform: scale(1);
        color: var(--col4);
      }
    }
    
    small {
      /*border: 1px solid var(--col4);*/
      border-radius: 99px;
      box-shadow: 1px 2px 5px var(--col4);
      white-space: nowrap;
      background: var(--col1);
      padding: 1%;
    }
    
    sup {
      margin: 0;
      padding: 0;
    }
    
    hr {
      margin: 0;
      border: none;
      padding: 0;
      height: 50px;
      width: 100%;
      background: var(--col1);
    }
    
    
    footer {
      position: fixed;
      bottom: 0;
      height: 5vh;
      background-color: var(--col4);
      color: var(--col2);
      width: 100%;
      justify-content: center;
      font-size: 50%;
      line-height: 5%;
      display: flex;
      flex-direction: column;
      align-items: center;
      
      & a {
        text-decoration: none;
        letter-spacing: 1.5px;
        color: var(--col1);
      }
      
      i {
        color: mediumvioletred;
      }
      
    }
    
    
    
    #studentPromptBox {
      width: 50vw;
      padding: 1em;
      display: flex;
      flex-direction: column;
      justify-content: center;
      border: 2px solid var(--col4);
      border-radius: 10px;
      background-color: var(--col2);
      margin-top: 6em;
      text-align: center;
      position: relative;
      z-index: 2001;
      font-size: var(--unit);
    }
    
    
    #studentPromptBox select,
    #studentPromptBox button {
      display: inline;
      width: 40vw;
      height: 5vh;
      border: none;
      border-radius: 15px;
      font-size: 70%;
      text-align: center;
      background: var(--col3);
      color: var(--col4);
    }
    
    #studentForm {
      justify-content: center;
    }
    
    .select-container {
      margin: 5%;
      display: flex;
      padding: 5%;
      font-size: 100%;
    }
    
    #studentPromptBox button {
      background-color: var(--col4);
      color: var(--col1);
      padding: 0em;
      border: 2px double var(--col2);
      border-radius: 15px;
      cursor: pointer;
      margin-top: 0em;
      font-size: 70%;
    }
    
    #studentPromptBox button:hover {
      background-color: var(--col3);
    }
    
    
    .table-container {
      position: fixed;
      top: 15%;
      height: 79.5%;
      overflow-x: hidden;
      overflow-y: auto;
      width: 95vw;
      font-size: 50%;
      padding: 0%;
      margin: 0;
      border-radius: 15px;
    }
    
    .timetable-wrapper {
      width: 100%;
      position: relative;
      scroll-behavior: smooth;
    }
    
    #contentArea {
      display: flex;
      width: 600%;
      /* 100% * number of days (6) */
      transition: transform 0.4s ease-in-out;
    }
    
    #contentArea .slide {
      width: calc(95vw * 6);
      flex-shrink: 0;
      display: table-row-group;
      /* Required to keep table row formatting */
      color: var(--col4);
      display: grid;
      
    }
    
    .slide p {
      padding: 0%;
      margin: 0.5% 0 0 1%;
      display: flex;
      flex-direction: column;
      white-space: nowrap;
      width: 90vw;
      border-radius: 15px;
      border: 2px solid var(--col4);
      background: var(--col3);
    }
    
    tr {
      border-radius: 15px;
      width: 95vw;
    }
    
    #semesterTabs .disabled {
      cursor: not-allowed;
    }
    
    @keyframes contentFadeIn {
      from {
        opacity: 0;
      }
      
      to {
        opacity: 1;
      }
    }
    
    /* Add this class for applying the animation */
    #contentArea.content-animate {
      animation: contentFadeIn 0.4s ease-out;
    }
    
    @keyframes shaking {
      0% {
        transform: none;
      }
      
      10% {
        transform: rotate(10deg) scale(1.05);
      }
      
      20% {
        transform: rotate(-10deg) scale(1.05);
      }
      
      30% {
        transform: rotate(10deg) scale(1.05);
      }
      
      40% {
        transform: rotate(-10deg) scale(1.05);
      }
      
      50% {
        transform: rotate(10deg) scale(1.05);
      }
      
      60% {
        transform: none;
      }
    }
  </style>
</head>

<body>
  <div id="studentPromptBox">
    <form id="studentForm">
      <H4> CLASS ROUTINE FOR DAY DEPARTMENT <i class="fa-solid fa-calendar-days"></i></H4>
      <div class="select-container">
        <label for="semesterSelect" hidden></label>
        <select id="semesterSelect" required>
          <option value="" hidden>Select Semister</option>
          <option value="1">1st</option>
          <option value="2">2nd</option>
          <option value="3">3rd</option>
          <option value="4">4th</option>
          <option value="5">5th</option>
          <option value="6">6th</option>
          <option value="7">7th</option>
          <option value="8">8th</option>
        </select>
      </div>
      
      <div class="select-container">
        <label for="departmentSelect" hidden></label>
        <select id="departmentSelect" required>
          <option value="" hidden>Select Stream</option>
          <option value="bcom">B.Com. (DAY)</option>
          <option value="ba">B.A.</option>
          <option value="bsc">B.Sc.</option>
        </select>
      </div>
      
      <button type="submit">Save Student Info &#8505;</button>
    </form>
  </div>
  
  <span><a href="https://bccrishra.ac.in/"><i class="fa-solid fa-link"></i> BIDHAN CHANDRA COLLEGE</a></span>
  <div id="edit" class="edit-button">
    <i class="fa-solid fa-circle-user">&nbsp;</i><bdi>hiuffu </bdi>
  </div>
  <div id="tabs">
    
    <!-- Course Tabs -->
    <div class="tabs hidden" id="courseTabs">
      <div class="tab" data-course="bcom"><i class="fa-solid fa-piggy-bank"></i> B.Com.</div>
      <div class="tab" data-course="ba"><i class="fa-solid fa-hand-holding-heart"></i> B.A.</div>
      <div class="tab" data-course="bsc"><i class="fa-solid fa-flask-vial"></i> B.Sc.</div>
    </div>
    
    <!-- Semester Tabs -->
    <div class="tabs hidden" id="semesterTabs">
      <div class="tab" data-semester="1st">1st</div>
      <div class="tab" data-semester="2nd">2nd</div>
      <div class="tab" data-semester="3rd">3rd</div>
      <div class="tab" data-semester="4th">4th</div>
      <div class="tab" data-semester="5th">5th</div>
      <div class="tab" data-semester="6th">6th</div>
      <div class="tab" data-semester="7th">7th</div>
      <div class="tab" data-semester="8th">8th</div>
    </div>
    
    <!-- Day Tabs -->
    <div class="tabs hidden" id="dayTabs">
      <div class="tab" data-day="mon">MON</div>
      <div class="tab" data-day="tue">TUE</div>
      <div class="tab" data-day="wed">WED</div>
      <div class="tab" data-day="thu">THU</div>
      <div class="tab" data-day="fri">FRI</div>
      <div class="tab" data-day="sat">SAT</div>
    </div>
  </div>
  <!-- Table Content -->
  <div class="table-container hidden">
    <div class="timetable-wrapper">
      <table id="contentArea">
        <tbody class="slide" id="mon-content"> </tbody>
        <tbody class="slide" id="tue-content"> </tbody>
        <tbody class="slide" id="wed-content"> </tbody>
        <tbody class="slide" id="thu-content"> </tbody>
        <tbody class="slide" id="fri-content"> </tbody>
        <tbody class="slide" id="sat-content"> </tbody>
      </table>
    </div>
  </div>
  <div id="fresh" class="hidden">
    SYNC
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><!--!Font Awesome Free v7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.-->
      <path d="M544.1 256L552 256C565.3 256 576 245.3 576 232L576 88C576 78.3 570.2 69.5 561.2 65.8C552.2 62.1 541.9 64.2 535 71L483.3 122.8C439 86.1 382 64 320 64C191 64 84.3 159.4 66.6 283.5C64.1 301 76.2 317.2 93.7 319.7C111.2 322.2 127.4 310 129.9 292.6C143.2 199.5 223.3 128 320 128C364.4 128 405.2 143 437.7 168.3L391 215C384.1 221.9 382.1 232.2 385.8 241.2C389.5 250.2 398.3 256 408 256L544.1 256zM573.5 356.5C576 339 563.8 322.8 546.4 320.3C529 317.8 512.7 330 510.2 347.4C496.9 440.4 416.8 511.9 320.1 511.9C275.7 511.9 234.9 496.9 202.4 471.6L249 425C255.9 418.1 257.9 407.8 254.2 398.8C250.5 389.8 241.7 384 232 384L88 384C74.7 384 64 394.7 64 408L64 552C64 561.7 69.8 570.5 78.8 574.2C87.8 577.9 98.1 575.8 105 569L156.8 517.2C201 553.9 258 576 320 576C449 576 555.7 480.6 573.4 356.5z" />
    </svg>
  </div>
  <footer>
    <p> Version 9.25.0 </p>
    <a href="https://www.instagram.com/shbmpp/"><i class="fa-brands fa-instagram"></i> shbmpp</a>
  </footer>
  
  <script>
    // Sc.hedule data
    const teacher_names = {
      MACD: { TM: "Tusher Mukherjee", AG: "Apala Ghosh", SRB: "Shawil Roy Basu" },
      IEED: { TM: "Tusher Mukherjee", AG: "Apala Ghosh", SRB: "Shawil Roy Basu" },
      COM: { SG: "Subhajit Ghosh", RKS: "Radha Kanta Sarkar", AJR: "Apurba Jyoti Roy", MS: "Md. Saifuddin", PK: "Puja Koley", MD: "Mahadev De", DM: "Debarbata Mukherjee", PD: "Pinaki Dutta" },
      
      CMSM: { UM: "Unmesh Mandal", SKP: "Sovan Kumar Panda", AJR: "Apurba Jyoti Roy", GD: "Goutam Das", RS: "Rimpi Saha" },
      MECO: { SRB: "Shawil Roy Basu", TM: "Tusher Mukherjee", AG: "Apala Ghosh" },
      MELT: { SKP: "Sovan Kumar Panda", AK: "Abdul Khaleque", SS: "Soumya Saha" },
      MTHM: { RK: "Ramesh Kar", MS: "Md. Saifuddin", SC: "Sucheta Chakraborty", PK: "Puja Koley" },
      MPHS: { SS: "Soumya Saha", AK: "Abdul Khaleque", MKS: "Masud Karim Sarkar" },
      
      BGNM: { TM: "Tanusree Mandal", NM: "Nagen Murmu", SM: "Sukanta Mukhopadhyay", PC: "Piyali Chakraborty", ASD: "Arpita Sil Dey" },
      EDCM: { SS: "Sanjay Sarkar", SNS: "Sunita Shaw", SN: "Sima Nandy", GG: "Gargi Ganguly" },
      ENGM: { AKP: "Asis Kumar Pan", PKB: "Prabir Kanti Basu", SS: "Sunandita Sarker", SPS: "Saptaparna Saha", AS: "Abir Sen" },
      GEOM: { LCP: "Lakshman Chandra Pal", AS: "Arghya Saha", PB: "Pabitra Bhattacharya" },
      HISM: { SMB: "Samindra Mohan Biswas", MD: "Mitali Dey", HB: "Haimanti Banarjee", EK: "Epsita Khan" },
      PHIM: { MSC: "Madhushree Chatterjee", BR: "Bhanumati Ray", MD: "Manisha Das" },
      PLSM: { DD: "Debdas Dey", DM: "Debtanu Majee", PKS: "Prashant Kumar Sharma", KR: "Kamal Roy", ADM: "Anindita Mitra" },
      SANM: { CM: "Chinmoy Mishra", AM: "Amit Mahato", ASR: "Arpita Singha Roy" },
      CONS: { AKS: "Anjay Kumar Singh", DM: "Debtanu Majee", PKS: "Prashant Kumar Sharma", KR: "Kamal Roy", ADM: "Anindita Mitra", AM: "Amit Mahato", BR: "Bhanumati Ray" },
      ENVS: { SS: "Soumya Saha", AK: "Abdul Khaleque" },
      ENGC: { AKP: "Asis Kumar Pan", PKB: "Prabir Kanti Basu", SS: "Sunandita Sarker", SPS: "Saptaparna Saha", AS: "Abir Sen" },
      LBEN: { SM: "Sukanta Mukhapadhyay", PC: "Piyali Chakraborty" },
      LHIN: { AKS: "Anjay Kumar Singh" }
    };
    
    //
    // --- ALIAS ‡¶§‡ßà‡¶∞‡¶ø ---
    //
    
    // BCOM
    teacher_names.MICD = teacher_names.MACD;
    
    // BSC
    teacher_names.CMSD = teacher_names.CMSM;
    teacher_names.MCMS = teacher_names.CMSM;
    teacher_names.ECOM = teacher_names.MECO;
    teacher_names.ECOD = teacher_names.MECO;
    teacher_names.ELTD = teacher_names.MELT;
    teacher_names.MMTH = teacher_names.MTHM;
    teacher_names.MTHD = teacher_names.MTHM;
    teacher_names.PHSD = teacher_names.MPHS;
    
    // BA
    teacher_names.MBGN = teacher_names.BGNM;
    teacher_names.BGND = teacher_names.BGNM;
    teacher_names.MEDC = teacher_names.EDCM;
    teacher_names.EDCD = teacher_names.EDCM;
    teacher_names.MENG = teacher_names.ENGM;
    teacher_names.ENGD = teacher_names.ENGM;
    teacher_names.MGEO = teacher_names.GEOM;
    teacher_names.GEOD = teacher_names.GEOM;
    teacher_names.MHIS = teacher_names.HISM;
    teacher_names.HISD = teacher_names.HISM;
    teacher_names.MPHI = teacher_names.PHIM;
    teacher_names.PHID = teacher_names.PHIM;
    teacher_names.MPLS = teacher_names.PLSM;
    teacher_names.PLSD = teacher_names.PLSM;
    teacher_names.MSAN = teacher_names.SANM;
    teacher_names.SAND = teacher_names.SANM;
    teacher_names.VIKS = teacher_names.CONS;
    teacher_names.ENVE = teacher_names.ENVS;
    teacher_names.ALEN = teacher_names.ENGC;
    
    // Subject names database
    const subject_names = {
      BCOM: {
        FACM: ["FINANCIAL ACCOUNTING I", "", "", "FINANCIAL ACCOUNTING II", "FINANCIAL MANAGEMENT"],
        FAGM: ["FINANCIAL ACCOUNTING I", "", "", "FINANCIAL ACCOUNTING II", "FINANCIAL MANAGEMENT"],
        
        CACM: ["", "COST ACCOUNTING I", "COST ACCOUNTING II", "", "ACCOUNTING THEORY"],
        CAGM: ["", "COST ACCOUNTING I", "COST ACCOUNTING II", "", "ACCOUNTING THEORY"],
        
        DTCM: ["", "", "DIRECT TAX I", "DIRECT TAX II & E-FILLING", "", "INDIRECT TAX"],
        DTGM: ["", "", "DIRECT TAX I", "DIRECT TAX II & E-FILLING", "", "INDIRECT TAX"],
        
        EBCM: "BUSINESS COMMUNICATION",
        EBGM: "BUSINESS COMMUNICATION",
        
        BRCM: "BUSINESS REGULATORY",
        BRGM: "BUSINESS REGULATORY",
        
        CRCM: "CORPORATE ACCOUNTING",
        CRGM: "CORPORATE ACCOUNTING",
        
        CLCM: "COMPANY LAW",
        CLGM: "COMPANY LAW",
        
        AUCM: "AUDITING & ASSURANCE",
        AUGM: "AUDITING & ASSURANCE",
        
        BMCM: "BUSINESS MATHEMATICS",
        BMGM: "BUSINESS MATHEMATICS",
        
        INCM: "INDIAN FINANCIAL SYSTEM",
        INGM: "INDIAN FINANCIAL SYSTEM",
        
        MPPM: "PRINCIPLES AND PRACTICE OF MANAGEMENT",
        MHRM: "BUSINESS MANAGEMENT (HRM)",
        MMKT: "CONSUMER BEHAVIOUR",
        MSMT: "SALES MANAGEMENT",
        MPDM: "PRODUCT & PRICING MANAGEMENT",
        MRCN: "MARKETING COMMUNICATION",
        MRSM: "RETAIL MANAGEMENT & SERVICES MARKETING",
        MRIM: "RURAL & INTERNATIONAL MARKETING",
        
        ENDC: "ENTREPRENEURSHIP DEVELOPMENT",
        ITAC: "INFORMATION TECHNOLOGY",
        CADC: "COMPUTERIZED ACCOUNTING",
        
        MICD: "MICROECONOMICS",
        MACD: "MACROECONOMICS",
        IEED: "INDIAN ECONOMICS",
        
        ENGC: "COMPULSORY ENGLISH",
        ALEN: "ALTERNATIVE ENGLISH",
        LBEN: "(AEC) - BENGALI",
        LHIN: "(AEC) - HINDI",
        CONS: "CONSTITUTIONAL VALUE & FUNDAMENTAL DUTIES",
        ENVS: "FUNDAMENTALS OF ENVIRONMENT",
        VIKS: "INDIAN KNOWLEDGE SYSTEM",
        ENVE: "ENVIRONMENTAL EDUCATION"
      },
      
      BA: {
        HISM: "HISTORY",
        MHIS: "HISTORY",
        HISD: "HISTORY",
        
        GEOM: "GEOGRAPHY",
        MGEO: "GEOGRAPHY",
        GEOD: "GEOGRAPHY",
        
        PHIM: "PHILOSOPHY",
        MPHI: "PHILOSOPHY",
        PHID: "PHILOSOPHY",
        
        ENGM: "ENGLISH",
        MENG: "ENGLISH",
        ENGD: "ENGLISH",
        
        PLSM: "POLITICAL SCIENCE",
        MPLS: "POLITICAL SCIENCE",
        PLSD: "POLITICAL SCIENCE",
        
        BGNM: "BENGALI",
        MBGN: "BENGALI",
        BGND: "BENGALI",
        
        EDCM: "EDUCATION",
        MEDC: "EDUCATION",
        EDCD: "EDUCATION",
        
        SANM: "SANSKRIT",
        MSAN: "SANSKRIT",
        SAND: "SANSKRIT",
        
        ECOM: "ECONOMICS",
        MECO: "ECONOMICS",
        ECOD: "ECONOMICS",
        
        ENGC: "COMPULSORY ENGLISH",
        ALEN: "ALTERNATIVE ENGLISH",
        LBEN: "(AEC) - BENGALI",
        LHIN: "(AEC) - HINDI",
        CONS: "CONSTITUTIONAL VALUE & FUNDAMENTAL DUTIES",
        ENVS: "FUNDAMENTALS OF ENVIRONMENT",
        VIKS: "INDIAN KNOWLEDGE SYSTEM",
        ENVE: "ENVIRONMENTAL EDUCATION"
      },
      
      BSC: {
        MPHS: "PHYSICS",
        PHSD: "PHYSICS",
        
        CMSM: "COMPUTER SCIENCE",
        MCMS: "COMPUTER SCIENCE",
        CMSD: "COMPUTER SCIENCE",
        
        MTHM: "MATHEMATICS",
        MMTH: "MATHEMATICS",
        MTHD: "MATHEMATICS",
        
        MELT: "ELECTRONICS",
        ELTD: "ELECTRONICS",
        
        ECOM: "ECONOMICS",
        MECO: "ECONOMICS",
        ECOD: "ECONOMICS",
        
        GEOM: "GEOGRAPHY",
        MGEO: "GEOGRAPHY",
        GEOD: "GEOGRAPHY",
        
        ENGC: "COMPULSORY ENGLISH",
        ALEN: "ALTERNATIVE ENGLISH",
        LBEN: "(AEC) - BENGALI",
        LHIN: "(AEC) - HINDI",
        CONS: "CONSTITUTIONAL VALUE & FUNDAMENTAL DUTIES",
        ENVS: "FUNDAMENTALS OF ENVIRONMENT",
        VIKS: "INDIAN KNOWLEDGE SYSTEM",
        ENVE: "ENVIRONMENTAL EDUCATION"
      }
    };
    
    function getSubjectName(codeStr) {
      if (!codeStr || codeStr.length < 4) return "Invalid Code";
      // üîπ ‡¶™‡ßç‡¶∞‡¶•‡¶Æ 3 ‡¶ï‡ßç‡¶Ø‡¶æ‡¶∞‡ßá‡¶ï‡ßç‡¶ü‡¶æ‡¶∞ ‚Üí sem, dept, year
      const sem = Number(codeStr[0]);
      const dept = Number(codeStr[1]);
      const year = Number(codeStr[2]);
      // üîπ ‡¶¨‡¶æ‡¶ï‡¶ø ‡¶Ö‡¶Ç‡¶∂ ‚Üí subj (+ optional SEC)
      let rest = codeStr.slice(3).toUpperCase();
      let isSEC = false,
        isMN = false;
      let subj = rest;
      
      if (rest.endsWith("SEC")) {
        isSEC = true;
        subj = rest.slice(0, -3); // "SEC" ‡¶¨‡¶æ‡¶¶ ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶Æ‡ßÇ‡¶≤ ‡¶∏‡¶æ‡¶¨‡¶ú‡ßá‡¶ï‡ßç‡¶ü
      } else if (rest.endsWith("MN")) {
        isMN = true;
        subj = rest.slice(0, -2); // "MN" ‡¶¨‡¶æ‡¶¶ ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶Æ‡ßÇ‡¶≤ ‡¶∏‡¶æ‡¶¨‡¶ú‡ßá‡¶ï‡ßç‡¶ü
      }
      
      // üîπ Stream mapping
      const departments = { 1: "BCOM", 2: "BA", 3: "BSC" };
      const departmentKey = departments[dept];
      const department = subject_names[departmentKey];
      if (!department) return "Invalid department";
      
      // --- BCOM CASE ---
      if (dept === 1) {
        let item = department[subj];
        
        // Handle array subjects
        if (Array.isArray(item)) {
          item = item[sem - 1] || item[0];
        }
        const iconKey = [
          { v: 1, k: ["FACM", "FAGM", "DTCM", "DTGM", "CACM", "CAGM", "AUCM", "AUGM"] },
          { v: 2, k: ["MPPM", "MHRM", "MMKT", "MSMT", "MPDM", "MRCN", "MRSM", "MRIM"] },
          { v: 3, k: [], c: () => isSEC },
          { v: 4, k: ["MICD", "MACD", "IEED"] },
          { v: 5, k: ["ENGC", "ALEN", "LBEN", "LHIN"] }
        ].find(g => (g.c?.() || g.k.includes(subj)))?.v || 6;
        const icons = [
          `<i class="fa-solid fa-coins"></i>`,
          `<i class="fa-solid fa-scale-unbalanced-flip"></i>`,
          `<i class="fa-solid fa-chalkboard"></i>`,
          `<i class="fa-solid fa-hand-holding-dollar"></i>`,
          `<i class="fa-solid fa-language"></i>`,
          `<i class="fa-solid fa-earth-asia"></i>`
        ];
        
        const icon = icons[iconKey - 1] || `<i class="fa-solid fa-book-open"></i>`;
        const yearSuffix = year === 1 ? "<small>Four Year</small>" : (year === 2 ? "<small>Three Year</small>" : "<small>Four & Three Year</small>");
        
        return `${icon} ${item} ${yearSuffix}`.trim();
      }
      
      // --- BA / BSC CASE ---
      else {
        // üîπ subject key ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶¨‡ßá‡¶∞ ‡¶ï‡¶∞‡¶æ
        const subject = department[subj];
        if (!subject) return "Course not found";
        
        const icons = {
          BA: [
            `<i class="fa-solid fa-landmark-dome"></i>`,
            `<i class="fa-solid fa-map-location-dot"></i>`,
            `<i class="fa-solid fa-book-journal-whills"></i>`,
            `<i class="fa-solid fa-earth-asia"></i>`,
            `<i class="fa-solid fa-landmark-flag"></i>`,
            `<i class="fa-solid fa-hands-praying"></i>`,
            `<i class="fa-solid fa-graduation-cap"></i>`,
            `<i class="fa-solid fa-om"></i>`,
            `<i class="fa-solid fa-language"></i>`,
            `<i class="fa-solid fa-yin-yang"></i>`
          ],
          BSC: [
            `<i class="fa-solid fa-atom"></i>`,
            `<i class="fa-solid fa-computer"></i>`,
            `<i class="fa-solid fa-square-root-variable"></i>`,
            `<i class="fa-solid fa-microchip"></i>`,
            `<i class="fa-solid fa-chart-line"></i>`,
            '',
            '',
            '',
            `<i class="fa-solid fa-language"></i>`,
            `<i class="fa-solid fa-yin-yang"></i>`
          ]
        };
        
        const iconSet = icons[departmentKey] || [];
        const iconKey = [
          { v: 1, k: ["HISM", "MHIS", "MPHS", "HISD", "PHSD"] },
          { v: 2, k: ["GEOM", "MGEO", "CMSM", "MCMS", "GEOD", "CMSD"] },
          { v: 3, k: ["PHIM", "MPHI", "MTHM", "MMTH", "PHID", "MTHD"] },
          { v: 4, k: ["ENGM", "MENG", "MELT", "ENGD", "ELTD"] },
          { v: 5, k: ["PLSM", "MPLS", "ECOM", "MECO", "PLSD", "ECOD"] },
          { v: 6, k: ["BGNM", "MBGN", "BGND"] },
          { v: 7, k: ["EDCM", "MEDC", "EDCD"] },
          { v: 8, k: ["SANM", "MSAN", "SAND"] },
          { v: 9, k: ["ENGC", "ALEN", "LBEN", "LHIN"] },
          { v: 10, k: ["CONS", "VIKS", "ENVS", "ENVE"] }
          
        ].find(g => g.k.includes(subj))?.v;
        const icon = dept === 2 ? iconSet[iconKey - 1] || `<i class="fa-solid fa-book-open"></i>` : iconSet[iconKey - 1] || `<i class="fa-solid fa-book-open"></i>`;
        
        // üîπ Paper ‡¶ß‡¶∞‡¶æ‡¶∞ ‡¶≤‡¶ú‡¶ø‡¶ï
        const paperName =
          (isMN && "(MINOR)") ||
          (isSEC && "(SEC)") ||
          (subj.endsWith("D") && "(IDC)") ||
          "";
        const yearType = year === 1 ? "<small>Four Year</small>" : (year === 2 ? "<small>Three Year</small>" : "<small>Four & Three Year</small>");
        return `${icon} ${subject} ${paperName} ${yearType}`.trim();
        
      }
    }
    
    
    function getTeacherName(code) {
      code = String(code || "").toUpperCase();
      // ‡¶™‡ßç‡¶∞‡¶•‡¶Æ 4 letters = subjectCode
      let subjectCode = code.slice(0, 4);
      // subjectCode ‡¶¨‡¶æ‡¶¶ ‡¶¶‡¶ø‡ßü‡ßá ‡¶¨‡¶æ‡¶ï‡¶ø‡¶ü‡¶æ = teacherCode
      let teacherCode = code.slice(4);
      
      // ‡¶Ø‡¶¶‡¶ø subjectCode ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡ßá ‡¶§‡¶¨‡ßá fallback COM
      let teachers = teacher_names[subjectCode];
      if (!teachers) {
        subjectCode = "COM";
        teachers = teacher_names.COM;
      }
      
      return teachers[teacherCode] || null;
    }
    
    
    const ROOM = {
      00: '',
      ...Object.fromEntries([...Array(7).keys()].map(i => [i + 1, `NEW BUILDING-${i+1}`])),
      19: "ROOM-9",
      10: "ROOM-10",
      14: "ROOM-14",
      15: "ROOM-15",
      16: "ROOM-16",
      17: "ROOM-17",
      20: "ROOM-20",
      21: "ROOM-21A",
      22: "ROOM-21B",
      23: "ROOM-23",
      25: "ROOM-25",
      ...Object.fromEntries([...Array(15).keys()].map(i => [i + 27, `ROOM-${i+27}`])),
      ...Object.fromEntries([...Array(5).keys()].map(i => [i + 41, `VIDYASAGAR HALL-${i+1}`])),
      ...Object.fromEntries([...Array(2).keys()].map(i => [i + 51, `COMPUTER LAB-${i+1}`]))
    };
    
    let scheduleData = {};
    let tableData = {};
    
    const DB_NAME = "ScheduleDB";
    const DB_STORE = "schedule";
    const DB_VERSION = 1;
    
    // IndexedDB init
    function openDB() {
      return new Promise((resolve, reject) => {
        const request = indexedDB.open(DB_NAME, DB_VERSION);
        
        request.onupgradeneeded = e => {
          const db = e.target.result;
          if (!db.objectStoreNames.contains(DB_STORE)) {
            db.createObjectStore(DB_STORE, { keyPath: "id" });
          }
        };
        
        request.onsuccess = e => resolve(e.target.result);
        request.onerror = e => reject(e.target.error);
      });
    }
    
    // Save data
    async function saveData(data) {
      const db = await openDB();
      const tx = db.transaction(DB_STORE, "readwrite");
      tx.objectStore(DB_STORE).put({ id: 1, data });
      return tx.complete;
    }
    
    // Get data
    async function getData() {
      const db = await openDB();
      return new Promise((resolve, reject) => {
        const tx = db.transaction(DB_STORE, "readonly");
        const store = tx.objectStore(DB_STORE);
        const req = store.get(1);
        req.onsuccess = () => resolve(req.result?.data);
        req.onerror = e => reject(e.target.error);
      });
    }
    
    // Fetch API & Update DB
    async function fetchAndStore() {
      try {
        const response = await fetch("https://raw.githubusercontent.com/shbmpp/college/refs/heads/main/bccr_classes.json");
        //const response = await fetch("./bccr_classes.json");
        const data = await response.json();
        await saveData(data);
        scheduleData = data;
        tableData = processScheduleData(prefix_adder(scheduleData));
        updateContent();
        applySemesterSelectStatus();
        applySemesterTabStatus(); 
        validateStoredStudent();
        document.getElementById('fresh').classList.remove('is-syncing');
      } catch (error) {
        console.error("Error fetching schedule:", error);
      }
    }
    
    // Load first time
    (async () => {
      const cached = await getData();
      if (cached) {
        scheduleData = cached;
        tableData = processScheduleData(prefix_adder(scheduleData));
        updateContent();
        applySemesterSelectStatus();
        applySemesterTabStatus();
        validateStoredStudent();
      } else {
        await fetchAndStore();
      }
    })();
    
    // Refresh when #fresh clicked
    document.getElementById("fresh").addEventListener("click", () => {
      const freshBtn = document.getElementById('fresh');
      freshBtn.classList.add('is-syncing'); // ‚¨ÖÔ∏è ‡¶Ü‡¶ó‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßã
      
      // ‡ß© ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° delay ‡¶¶‡¶ø‡ßü‡ßá API ‡¶ï‡¶≤ ‡¶ï‡¶∞‡ßã
      setTimeout(() => {
        fetchAndStore();
      }, 3000);
    });
    
    function semesterHasData(semKey) {
      const sem = scheduleData[semKey];
      if (!sem) return false;
      
      const streams = ["bcom", "ba", "bsc"];
      const days = ["mon", "tue", "wed", "thu", "fri", "sat"];
      
      return streams.some(stream => {
        const s = sem[stream];
        if (!s) return false;
        
        return days.some(day => {
          const arr = s[day];
          if (!Array.isArray(arr)) return false;
          
          return arr.some(cell => cell && cell.trim() !== "");
        });
      });
    }
    
    function applySemesterTabStatus() {
      if (!scheduleData || Object.keys(scheduleData).length === 0) {
        // ‡¶°‡¶æ‡¶ü‡¶æ ‡¶®‡¶æ‡¶á ‡¶è‡¶ñ‡¶®‡ßã, ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶ï‡¶∞‡¶¨‡ßá‡¶®‡¶æ
        return;
      }
      
      const tabs = document.querySelectorAll("#semesterTabs .tab");
      
      tabs.forEach(tab => {
        const key = tab.dataset.semester;
        
        if (semesterHasData(key)) {
          // Enable
          tab.classList.remove("disabled");
          tab.style.pointerEvents = "auto";
          tab.style.opacity = "1";
          tab.setAttribute("aria-disabled", "false");
        } else {
          // Disable
          tab.classList.add("disabled");
          tab.style.pointerEvents = "none";
          tab.style.opacity = "0.5";
          tab.setAttribute("aria-disabled", "true");
        }
      });
    }
    
    function semValueToKey(value) {
      const n = parseInt(value, 10);
      if (!n) return null;
      const suffix = (n === 1) ? "st" :
        (n === 2) ? "nd" :
        (n === 3) ? "rd" :
        "th";
      return n + suffix; // 1 ‚Üí "1st", 2 ‚Üí "2nd" ...
    }
    
    function applySemesterSelectStatus() {
      if (!scheduleData || Object.keys(scheduleData).length === 0) {
        return;
      }
      
      const select = document.getElementById("semesterSelect");
      if (!select) return;
      
      Array.from(select.options).forEach(option => {
        const value = option.value;
        if (!value) return; // "Select Semister" hidden option
        
        const semKey = semValueToKey(value); // "1" ‚Üí "1st"
        
        if (semesterHasData(semKey)) {
          option.disabled = false;
          option.style.opacity = "1";
        } else {
          option.disabled = true;
          option.style.opacity = "0.5";
        }
      });
    }
    
    function validateStoredStudent() {
  const studentRaw = localStorage.getItem("student");
  if (!studentRaw) return;

  const student = JSON.parse(studentRaw);
  if (!student.semester) return;

  const semKey = semValueToKey(student.semester);  // ‡¶Ø‡ßá‡¶Æ‡¶® "2" ‚Üí "2nd"

  // ‡¶Ø‡¶¶‡¶ø ‡¶ì‡¶á ‡¶∏‡ßá‡¶Æ‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞‡ßá ‡¶°‡¶æ‡¶ü‡¶æ ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡ßá ‚Üí student key delete
  if (!semesterHasData(semKey)) {
    localStorage.removeItem("student");
    updateStudentPromptUI();
  }
}

    function prefix_adder(schedule) {
      const result = {};
      const streamMap = { bcom: 1, ba: 2, bsc: 3 };
      const semesterMap = {
        "1st": 1,
        "2nd": 2,
        "3rd": 3,
        "4th": 4,
        "5th": 5,
        "6th": 6,
        "7th": 7,
        "8th": 8
      };
      
      for (const [semester, streams] of Object.entries(schedule)) {
        const semDigit = semesterMap[semester];
        result[semester] = {};
        
        for (const [stream, days] of Object.entries(streams)) {
          const streamDigit = streamMap[stream];
          result[semester][stream] = {};
          
          for (const [day, periods] of Object.entries(days)) {
            result[semester][stream][day] = periods.map(period => {
              if (!period.trim()) return "";
              
              const codes = period.split(" ");
              // ‡¶ß‡¶∞‡¶≤‡¶æ‡¶Æ semDigit, streamDigit ‡¶¨‡¶æ‡¶á‡¶∞‡ßá‡¶∞ scope ‡¶•‡ßá‡¶ï‡ßá ‡¶Ü‡¶õ‡ßá
              const transformedCodes = codes.map(code => {
                // Normalize
                let normalized = String(code || "").toUpperCase();
                // ‡¶Ø‡¶¶‡¶ø ‡¶∂‡ßÅ‡¶∞‡ßÅ‡¶§‡ßá digit ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡ßá ‚Üí ‡¶∏‡¶æ‡¶Æ‡¶®‡ßá "0" ‡¶¨‡¶∏‡¶æ‡¶ì
                if (!/^\d/.test(normalized)) {
                  normalized = "0" + normalized;
                }
                
                // prefixLen = leading digits count
                const prefixDigits = (normalized.match(/^\d*/)[0] || "");
                
                // subjectPart: prefix ‡¶¨‡¶æ‡¶¶ ‡¶¶‡¶ø‡ßü‡ßá ‡¶¨‡¶æ‡¶ï‡¶ø ‡¶Ö‡¶Ç‡¶∂ (letters+digits)
                const subjectPart = normalized.slice(prefixDigits.length);
                
                // lettersOnly: digits ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶π‡¶ì‡ßü‡¶æ‡¶∞ ‡¶Ü‡¶ó ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§ ‡¶∏‡¶¨ ‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞
                const lettersOnly = subjectPart.replace(/\d.*$/, '');
                
                // roomCode: ‡¶∂‡ßá‡¶∑‡ßá ‡¶•‡¶æ‡¶ï‡¶æ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ (‡¶Ø‡¶¶‡¶ø ‡¶•‡¶æ‡¶ï‡ßá)
                const roomMatch = subjectPart.match(/\d+$/);
                const roomCode = roomMatch ? roomMatch[0] : "";
                
                // marker detection
                const idxSEC = lettersOnly.indexOf("SEC");
                const idxMN = lettersOnly.indexOf("MN");
                
                let isSEC = false,
                  isMN = false;
                let subjectCode = "";
                let teacherCode = "";
                
                if (idxSEC !== -1 && (idxMN === -1 || idxSEC < idxMN)) {
                  isSEC = true;
                  subjectCode = lettersOnly.slice(0, idxSEC) || lettersOnly.slice(0, 4);
                  teacherCode = lettersOnly.slice(idxSEC + 3) || "";
                } else if (idxMN !== -1) {
                  isMN = true;
                  subjectCode = lettersOnly.slice(0, idxMN) || lettersOnly.slice(0, 4);
                  teacherCode = lettersOnly.slice(idxMN + 2) || "";
                } else {
                  // Normal case
                  subjectCode = lettersOnly.slice(0, 4);
                  teacherCode = lettersOnly.slice(4) || "";
                }
                
                // fallback (safety)
                if (!subjectCode) subjectCode = lettersOnly.slice(0, 4) || "";
                
                // Final return format
                return `${semDigit}${streamDigit}${prefixDigits}${subjectCode}${isSEC ? "SEC" : isMN ? "MN" : ""}${subjectCode}${teacherCode}${roomCode}`;
              });
              
              
              return transformedCodes.join(" ");
            });
          }
        }
      }
      return result;
    }
    
    const slots = [
      "10AM‚Äî11AM", "11AM‚Äî12PM", "12PM‚Äî1PM", "1PM‚Äî2PM", "2PM‚Äî3PM", "3PM‚Äî4PM", "4PM‚Äî5PM"
    ];
    
    function processScheduleData(transformedData) {
      const result = {};
      
      // Helper parser function
      function parseCode(code) {
        code = String(code || "").toUpperCase();
        let subjectCode = "";
        let teacherCode = "";
        let roomCode = "";
        
        if (code.length < 5) return { subjectCode, teacherCode, roomCode };
        
        // ‡¶™‡ßç‡¶∞‡¶•‡¶Æ 3 character prefix ‡¶ß‡¶∞‡¶ø
        const prefix = code.slice(0, 3);
        const subjectPart = code.slice(3); // ‡¶¨‡¶æ‡¶ï‡¶ø‡¶ü‡¶æ subject+teacher+room
        
        // digit ‡¶è‡¶∞ index ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶¨‡ßá‡¶∞ ‡¶ï‡¶∞‡ßã ‚Üí roomCode ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶è‡¶ñ‡¶æ‡¶® ‡¶•‡ßá‡¶ï‡ßá
        const firstDigitIndex = subjectPart.search(/\d/);
        let mainPart = subjectPart;
        if (firstDigitIndex !== -1) {
          mainPart = subjectPart.slice(0, firstDigitIndex);
          roomCode = subjectPart.slice(firstDigitIndex);
        }
        
        // ‡¶è‡¶ñ‡¶® MN / SEC detect
        if (mainPart.includes("MN")) {
          const idx = mainPart.indexOf("MN");
          subjectCode = prefix + mainPart.slice(0, idx + 2);
          teacherCode = mainPart.slice(idx + 2);
        } else if (mainPart.includes("SEC")) {
          const idx = mainPart.indexOf("SEC");
          subjectCode = prefix + mainPart.slice(0, idx + 3);
          teacherCode = mainPart.slice(idx + 3);
        } else {
          // Normal case ‚Üí ‡¶™‡ßç‡¶∞‡¶•‡¶Æ 4 letter subject, ‡¶¨‡¶æ‡¶ï‡¶ø teacher
          subjectCode = prefix + mainPart.slice(0, 4);
          teacherCode = mainPart.slice(4);
        }
        
        return { subjectCode, teacherCode, roomCode };
      }
      // ---------- First pass ----------
      for (const [semester, streams] of Object.entries(transformedData)) {
        result[semester] = {};
        
        for (const [stream, days] of Object.entries(streams)) {
          result[semester][stream] = {};
          
          for (const [day, periods] of Object.entries(days)) {
            result[semester][stream][day] = periods.map((periodStr, time) => {
              if (!periodStr || typeof periodStr !== "string" || !periodStr.trim()) return "";
              
              const codes = periodStr.split(" ").filter(c => c.trim().length > 0);
              if (codes.length === 0) return "";
              
              const processedCodes = codes.map(code => {
                const { subjectCode, teacherCode, roomCode } = parseCode(code);
                
                const subject = getSubjectName(subjectCode);
                const teacher = getTeacherName(teacherCode) || "";
                const room = ROOM[parseInt(roomCode)] || '';
                const isTeacher = teacher ? `&nbsp&nbsp&nbsp <i class="fa-solid fa-user-tie"></i> ` : "";
                const isRoom = room ? "at " : "";
                const timeStamp = (slots[time].split("‚Äî")[0]).replace(/(\d+)(AM|PM)/i, "$1 $2");
                
                return `<p><strong>${subject}</strong><strong style="display:${teacher ? 'block' : 'none'}">${isTeacher}${teacher}</strong><strong>${isRoom}${room} on <em> <i class="fa-solid fa-clock"></i> ${timeStamp}</em></strong></p>`;
              });
              
              return processedCodes.join("");
            });
          }
        }
      }
      
      // ---------- Second pass: handle special cases ----------
      for (const [semester, streams] of Object.entries(transformedData)) {
        for (const [stream, days] of Object.entries(streams)) {
          for (const [day, periods] of Object.entries(days)) {
            periods.forEach((periodStr, time) => {
              if (!periodStr || typeof periodStr !== "string" || !periodStr.trim()) return;
              
              const codes = periodStr.split(" ").filter(c => c.trim().length > 0);
              if (codes.length === 0) return;
              
              codes.forEach(code => {
                const { subjectCode, teacherCode, roomCode } = parseCode(code);
                
                if (!subjectCode) return;
                
                const subject = getSubjectName(subjectCode);
                const teacher = getTeacherName(teacherCode) || "";
                const room = ROOM[parseInt(roomCode)] || '';
                const isTeacher = teacher ? ` &nbsp&nbsp&nbsp <i class="fa-solid fa-user-tie"></i> ` : "";
                const isRoom = room ? "at " : "";
                const timeStamp = (slots[time].split("‚Äî")[0]).replace(/(\d+)(AM|PM)/i, "$1 $2");
                
                // Example: inject BA/BSC special cases (‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶≤‡¶ú‡¶ø‡¶ï Í∑∏ÎåÄÎ°ú ‡¶∞‡¶æ‡¶ñ‡¶≤‡¶æ‡¶Æ)
                if (subjectCode[1] === "2" && ["GEOM", "MGEO", "GEOD"].includes(subjectCode.slice(3, 7))) {
                  if (!result[semester]["bsc"]) result[semester]["bsc"] = {};
                  if (!result[semester]["bsc"][day]) result[semester]["bsc"][day] = Array(periods.length).fill("");
                  result[semester]["bsc"][day][time] += `<p><strong>${subject}</strong><strong style="display:${teacher ? 'block' : 'none'}">${isTeacher}${teacher}</strong><strong>${isRoom}${room} on <em><i class="fa-solid fa-clock"></i> ${timeStamp}</em></strong></p>`;
                } else if (subjectCode[1] === "3" && ["ECOM", "MECO", "ECOD"].includes(subjectCode.slice(3, 7))) {
                  if (!result[semester]["ba"]) result[semester]["ba"] = {};
                  if (!result[semester]["ba"][day]) result[semester]["ba"][day] = Array(periods.length).fill("");
                  result[semester]["ba"][day][time] += `<p><strong>${subject}</strong><strong style="display:${teacher ? 'block' : 'none'}">${isTeacher}${teacher}</strong><strong>${isRoom}${room} on <em><i class="fa-solid fa-clock"></i> ${timeStamp}</em></strong></p>`;
                }
              });
            });
          }
        }
      }
      
      return result;
    }
    
    let latestGlowingRow = null;
    
    const semesterTabs = document.querySelectorAll("#semesterTabs .tab");
    const courseTabs = document.querySelectorAll("#courseTabs .tab");
    const dayTabs = document.querySelectorAll("#dayTabs .tab");
    let activeDayTab = undefined;
    
    function setActiveTab(tabs, activeData) {
      if (!tabs || !activeData) return; // ‡¶Ø‡¶¶‡¶ø tabs ‡¶¨‡¶æ activeData ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡ßá
      tabs.forEach(tab => {
        const { semester, course, day } = tab.dataset || {};
        if (semester === activeData || course === activeData || day === activeData) {
          tab.classList.add("active");
          if (day) activeDayTab = day;
        } else {
          tab.classList.remove("active");
        }
      });
    }
    
    function updateContent(isClickedOnSemOrCourseTabs = false) {
      const student = JSON.parse(localStorage.getItem("student"));
      if (!student) return;
      
      const activeSemester = document.querySelector("#semesterTabs .tab.active").dataset.semester;
      const activeCourse = document.querySelector("#courseTabs .tab.active").dataset.course;
      const Day = document.querySelector("#dayTabs .tab.active").dataset.day;
      
      const daysData = tableData[activeSemester]?.[activeCourse] || {};
      const contentArea = document.getElementById("contentArea");
      
      if (isClickedOnSemOrCourseTabs) {
        contentArea.classList.remove("content-animate");
        void contentArea.offsetWidth; // reflow
      }
      
      contentArea.innerHTML = ""; // Clear previous content
      if (!daysData) return;
      
      Object.keys(daysData).forEach(day => {
        const timeData = daysData[day];
        const tbody = document.createElement("tbody");
        tbody.className = "slide";
        tbody.id = `${day}-content`;
        
        // üîé ‡¶è‡¶ñ‡¶æ‡¶®‡ßá day-level ‡¶ö‡ßá‡¶ï
        const isDayEmpty = !timeData ||
          !Array.isArray(timeData) ||
          timeData.length === 0 ||
          timeData.every(p => !p || p.trim() === "");
        
        if (isDayEmpty) {
          tbody.innerHTML = `<tr><td style="text-align:center; font-size: 200%; width: 95vw; height: 30vh"> No Classes Scheduled!! </td></tr>`;
        } else if (Day !== day) {
          tbody.innerHTML = "";
        } else {
          let count = 0;
          const validCount = timeData.filter(Boolean).length;
          tbody.innerHTML = timeData
            .map(data => data ? `<tr><td>${data}</td></tr>${++count < validCount ? `<hr>` : ''}` : "")
            .join("");
        }
        
        contentArea.appendChild(tbody);
      });
      
      if (isClickedOnSemOrCourseTabs) contentArea.classList.add("content-animate");
      highlightCurrentSlot();
    }
    const forceToGlow = (row) => {
      if (activeDay !== defaultDay) return;
      if (!row) return;
      
      const rect = row.getBoundingClientRect();
      const viewportHeight = window.innerHeight;
      
      // Element ‡¶Ø‡¶¶‡¶ø viewport-‡¶è‡¶∞ ‡¶¨‡¶æ‡¶á‡¶∞‡ßá ‡¶•‡¶æ‡¶ï‡ßá
      const completelyAbove = rect.bottom <= 200;
      const completelyBelow = rect.top >= viewportHeight;
      
      if (completelyAbove || completelyBelow) {
        row.scrollIntoView({ behavior: "smooth", block: "center" });
      }
    };
    
    semesterTabs.forEach(tab => {
      tab.addEventListener("click", () => {
        setActiveTab(semesterTabs, tab.dataset.semester);
        updateContent(true);
        setTimeout(() => {
          forceToGlow(latestGlowingRow);
        }, 500); // 500ms delay
      });
    });
    
    courseTabs.forEach(tab => {
      tab.addEventListener("click", () => {
        setActiveTab(courseTabs, tab.dataset.course);
        updateContent(true);
        setTimeout(() => {
          forceToGlow(latestGlowingRow);
        }, 500); // 500ms delay
      });
    });
    
    dayTabs.forEach(tab => {
      tab.addEventListener("click", () => {
        setActiveTab(dayTabs, tab.dataset.day);
        updateContent();
        setTimeout(() => {
          forceToGlow(latestGlowingRow);
        }, 500); // 500ms delay
      });
    });
    
    
    
    const currentDay = new Date().toLocaleString("en-us", { weekday: "short" }).toLowerCase();
    const dayMapping = {
      sun: "mon",
      mon: "mon",
      tue: "tue",
      wed: "wed",
      thu: "thu",
      fri: "fri",
      sat: "sat"
    };
    
    const defaultDay = dayMapping[currentDay];
    setActiveTab(dayTabs, defaultDay);
    const activeDay = document.querySelector("#dayTabs .tab.active").dataset.day;
    document.addEventListener('DOMContentLoaded', () => {
      const table = document.querySelector('#contentArea');
      const dayTabs = document.querySelectorAll('#dayTabs .tab');
      const days = ['mon', 'tue', 'wed', 'thu', 'fri', 'sat'];
      const $currentIndex = days.indexOf(defaultDay);
      let currentIndex = days.indexOf(defaultDay);
      let startX = 0;
      
      function updateSlider() {
        const shift = -(currentIndex * 100);
        table.style.transform = `translateX(${shift}%)`;
        highlightDayTab(days[currentIndex]);
        updateContent();
        highlightCurrentSlot();
      }
      
      function highlightDayTab(day) {
        dayTabs.forEach(tab => {
          setActiveTab(dayTabs, day);
          setTimeout(() => {
            forceToGlow(latestGlowingRow);
          }, 500); // 500ms delay
        });
      }
      
      dayTabs.forEach((tab, index) => {
        tab.addEventListener('click', () => {
          currentIndex = index;
          updateSlider();
        });
      });
      
      table.addEventListener('touchstart', (e) => {
        startX = e.touches[0].clientX;
      }, { passive: true });
      
      table.addEventListener('touchend', (e) => {
        const endX = e.changedTouches[0].clientX;
        const diff = startX - endX;
        
        if (Math.abs(diff) > 75) {
          if (diff > 0 && currentIndex < days.length - 1) {
            currentIndex++;
          } else if (diff < 0 && currentIndex > 0) {
            currentIndex--;
          }
          updateSlider();
        }
      });
      updateSlider();
      updateStudentPromptUI();
    });
    
    
    function isCurrentTimeInSlot(slot) {
      const [startStr, endStr] = slot.split("‚Äî").map(s => s.trim().toUpperCase());
      
      const parseTime = (timeStr) => {
        const [hourMin, meridian] = [timeStr.slice(0, -2).trim(), timeStr.slice(-2)];
        let [hour, minute] = hourMin.split(":").map(Number);
        if (isNaN(minute)) minute = 0;
        
        if (meridian === "PM" && hour !== 12) hour += 12;
        if (meridian === "AM" && hour === 12) hour = 0;
        
        const now = new Date();
        return new Date(now.getFullYear(), now.getMonth(), now.getDate(), hour, minute, 0).getTime();
      };
      
      const start = parseTime(startStr);
      const end = parseTime(endStr);
      const now = new Date().getTime();
      
      return now >= start && now <= end;
    }
    
    
    function highlightCurrentSlot() {
      const hasStudent = localStorage.getItem("student");
      if (!hasStudent) return;
      const currentDay = new Date().toLocaleString("en-us", { weekday: "short" }).toLowerCase();
      const activeDay = document.querySelector("#dayTabs .tab.active")?.dataset.day;
      if (currentDay !== activeDay) return;
      
      const activeSemester = document.querySelector("#semesterTabs .tab.active")?.dataset.semester;
      const activeCourse = document.querySelector("#courseTabs .tab.active")?.dataset.course;
      const timeData = tableData[activeSemester]?.[activeCourse]?.[activeDay];
      
      if (!timeData || !Array.isArray(timeData)) return;
      const day = document.getElementById(`${activeDay}-content`);
      
      slots.forEach((slot, index) => {
        const hasData = typeof timeData[index] === "string" && timeData[index].trim();
        
        if (isCurrentTimeInSlot(slot) && hasData) {
          const slotStartTime = slot.split("‚Äî")[0]; // e.g., "11AM"
          const slotTimeRegex = new RegExp(`\\b${slotStartTime.replace(/(\d+)(AM|PM)/, '$1 ?$2')}\\b`, 'i');
          
          day.querySelectorAll("p").forEach(p => {
            const text = p.textContent;
            if (slotTimeRegex.test(text)) {
              latestGlowingRow = p;
              const em = p.querySelectorAll("em");
              em.forEach(e => {
                e.classList.add("shake");
              });
              const teacherName = p.querySelectorAll("strong:nth-child(2)");
              teacherName.forEach(e => {
                e.classList.add("high");
              });
            }
          });
        }
      });
    }
    
    
    setInterval(highlightCurrentSlot, 1000); // Update every second to check the time
    function updateStudentPromptUI() {
      const hasStudent = localStorage.getItem("student");
      [...document.querySelectorAll('.hidden')].forEach(el => el.style.display = hasStudent ? 'flex' : 'none');
      document.getElementById("studentPromptBox").style.display = hasStudent ? "none" : "block";
      document.getElementById("edit").style.display = hasStudent ? "block" : "none";
      if (hasStudent) {
        const stdDetails = JSON.parse(localStorage.getItem("student"));
        const sems = Object.fromEntries(
          Array.from({ length: 8 }, (_, i) => {
            const n = i + 1;
            const suffix = `<sup>${['st','nd','rd'][n - 1] || 'th'}</sup>`;
            return [n, `${n}${suffix} SEM`];
          })
        );
        const deptNames = { bcom: 'B.Com.', ba: 'B.A.', bsc: 'B.Sc.' };
        const [semKey, deptKey] = Object.values(stdDetails).slice(0, 2);
        const display = `${sems[semKey]} - ${deptNames[deptKey]}`;
        document.querySelector('#edit bdi').innerHTML = display;
      }
    }
    
    function activateStudentTabs() {
      const student = JSON.parse(localStorage.getItem("student"));
      if (!student) return;
      const suffixMap = ["1st", "2nd", "3rd", "4th", "5th", "6th", "7th", "8th"];
      const semesterLabel = suffixMap[parseInt(student.semester) - 1];
      const departmentKey = student.department.toLowerCase();
      setActiveTab(semesterTabs, semesterLabel);
      setActiveTab(courseTabs, departmentKey);
      setActiveTab(dayTabs, defaultDay);
      updateContent(true);
    }
    
    document.getElementById("studentForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const semester = document.getElementById("semesterSelect").value;
      const dept = document.getElementById("departmentSelect")?.value;
      if (semester && dept) {
        localStorage.setItem("student", JSON.stringify({ semester, department: dept }));
        updateStudentPromptUI();
        activateStudentTabs();
      }
    });
    
    document.getElementById("edit").addEventListener("click", () => {
      localStorage.removeItem("student");
      updateStudentPromptUI();
    });
    
    updateStudentPromptUI();
    
    if (localStorage.getItem("student")) {
      activateStudentTabs();
    }
  </script>
</body>

</html>